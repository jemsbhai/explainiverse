============================= test session starts =============================
platform win32 -- Python 3.12.2, pytest-8.4.2, pluggy-1.6.0 -- E:\data\code\claudecode\explainiverse\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: E:\data\code\claudecode\explainiverse
configfile: pyproject.toml
plugins: cov-4.1.0
collecting ... collected 47 items

tests/test_selectivity.py::TestSelectivityBasic::test_returns_float PASSED [  2%]
tests/test_selectivity.py::TestSelectivityBasic::test_non_negative_score PASSED [  4%]
tests/test_selectivity.py::TestSelectivityBasic::test_deterministic_same_seed PASSED [  6%]
tests/test_selectivity.py::TestSelectivityBasic::test_use_absolute_true PASSED [  8%]
tests/test_selectivity.py::TestSelectivityBasic::test_use_absolute_false PASSED [ 10%]
tests/test_selectivity.py::TestSelectivityBasic::test_use_absolute_affects_ordering PASSED [ 12%]
tests/test_selectivity.py::TestNSteps::test_default_n_steps PASSED       [ 14%]
tests/test_selectivity.py::TestNSteps::test_n_steps_half PASSED          [ 17%]
tests/test_selectivity.py::TestNSteps::test_n_steps_one PASSED           [ 19%]
tests/test_selectivity.py::TestNSteps::test_n_steps_exceeds_features PASSED [ 21%]
tests/test_selectivity.py::TestNSteps::test_different_n_steps_different_scores PASSED [ 23%]
tests/test_selectivity.py::TestReturnDetails::test_return_details_structure PASSED [ 25%]
tests/test_selectivity.py::TestReturnDetails::test_prediction_drops_length PASSED [ 27%]
tests/test_selectivity.py::TestReturnDetails::test_prediction_drops_starts_at_zero PASSED [ 29%]
tests/test_selectivity.py::TestReturnDetails::test_aopc_is_mean_of_drops PASSED [ 31%]
tests/test_selectivity.py::TestReturnDetails::test_feature_order_is_permutation PASSED [ 34%]
tests/test_selectivity.py::TestReturnDetails::test_aopc_matches_standalone_call PASSED [ 36%]
tests/test_selectivity.py::TestBaselineTypes::test_baseline_mean PASSED  [ 38%]
tests/test_selectivity.py::TestBaselineTypes::test_baseline_median PASSED [ 40%]
tests/test_selectivity.py::TestBaselineTypes::test_baseline_scalar PASSED [ 42%]
tests/test_selectivity.py::TestBaselineTypes::test_baseline_array PASSED [ 44%]
tests/test_selectivity.py::TestBaselineTypes::test_baseline_callable FAILED [ 46%]
tests/test_selectivity.py::TestBatchOperations::test_batch_returns_dict PASSED [ 48%]
tests/test_selectivity.py::TestBatchOperations::test_batch_max_samples PASSED [ 51%]
tests/test_selectivity.py::TestBatchOperations::test_batch_values_are_floats PASSED [ 53%]
tests/test_selectivity.py::TestBatchOperations::test_batch_n_steps_parameter PASSED [ 55%]
tests/test_selectivity.py::TestMultipleModels::test_random_forest PASSED [ 57%]
tests/test_selectivity.py::TestMultipleModels::test_gradient_boosting PASSED [ 59%]
tests/test_selectivity.py::TestExplainerComparison::test_lime_shap_both_valid FAILED [ 61%]
tests/test_selectivity.py::TestEdgeCases::test_few_features PASSED       [ 63%]
tests/test_selectivity.py::TestEdgeCases::test_many_features PASSED      [ 65%]
tests/test_selectivity.py::TestEdgeCases::test_identical_attributions PASSED [ 68%]
tests/test_selectivity.py::TestEdgeCases::test_zero_attributions PASSED  [ 70%]
tests/test_selectivity.py::TestEdgeCases::test_single_feature PASSED     [ 72%]
tests/test_selectivity.py::TestEdgeCases::test_two_features PASSED       [ 74%]
tests/test_selectivity.py::TestEdgeCases::test_highly_skewed_attributions PASSED [ 76%]
tests/test_selectivity.py::TestEdgeCases::test_negative_attributions_only PASSED [ 78%]
tests/test_selectivity.py::TestSemanticValidation::test_good_explanation_higher_aopc PASSED [ 80%]
tests/test_selectivity.py::TestSemanticValidation::test_inverted_explanation_different_score PASSED [ 82%]
tests/test_selectivity.py::TestSemanticValidation::test_prediction_drops_are_cumulative PASSED [ 85%]
tests/test_selectivity.py::TestTargetClass::test_explicit_target_class PASSED [ 87%]
tests/test_selectivity.py::TestTargetClass::test_default_target_class_uses_predicted PASSED [ 89%]
tests/test_selectivity.py::TestAOPCDefinition::test_aopc_formula PASSED  [ 91%]
tests/test_selectivity.py::TestAOPCDefinition::test_morf_ordering PASSED [ 93%]
tests/test_selectivity.py::TestAOPCDefinition::test_step_by_step_removal PASSED [ 95%]
tests/test_selectivity.py::TestComparisonWithPixelFlipping::test_both_measure_sequential_removal PASSED [ 97%]
tests/test_selectivity.py::TestComparisonWithPixelFlipping::test_different_aggregation PASSED [100%]

================================== FAILURES ===================================
__________________ TestBaselineTypes.test_baseline_callable ___________________
tests\test_selectivity.py:526: in test_baseline_callable
    score = compute_selectivity(
src\explainiverse\evaluation\faithfulness_extended.py:324: in compute_selectivity
    baseline_values = compute_baseline_values(
src\explainiverse\evaluation\_utils.py:186: in compute_baseline_values
    result = baseline(background_data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: TestBaselineTypes.test_baseline_callable.<locals>.custom_baseline() missing 1 required positional argument: 'n_features'
______________ TestExplainerComparison.test_lime_shap_both_valid ______________
tests\test_selectivity.py:693: in test_lime_shap_both_valid
    shap = ShapExplainer(
E   TypeError: ShapExplainer.__init__() missing 1 required positional argument: 'class_names'
=========================== short test summary info ===========================
FAILED tests/test_selectivity.py::TestBaselineTypes::test_baseline_callable - TypeError: TestBaselineTypes.test_baseline_callable.<locals>.custom_baseline() missing 1 required positional argument: 'n_features'
FAILED tests/test_selectivity.py::TestExplainerComparison::test_lime_shap_both_valid - TypeError: ShapExplainer.__init__() missing 1 required positional argument: 'class_names'
======================== 2 failed, 45 passed in 3.41s =========================
